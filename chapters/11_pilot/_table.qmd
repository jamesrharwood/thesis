{{< pagebreak >}}

::: {.landscape}

```{python}
#| column: page
#| echo: false
#| output: asis

import os
import yaml
from IPython.display import Markdown, display
from tabulate import tabulate
from data import BARRIERS
import texttable
from collections import defaultdict

SEE_ABOVE = ""

COLS = ['Method', 'Intervention Components']
COL_RANGE = range(len(COLS))
WIDTHS = [500, 500]
ALIGNMENTS = ['l' for _ in COL_RANGE]
DIR = os.getcwd()
FP = os.path.join(DIR, 'chapters', '9_defining_content', 'planning_table.yaml')
with open(FP, 'r') as f:
    data = yaml.safe_load(f)
components = []
for key_behaviour in data.values():
    for barrier in key_behaviour.values():
        ingredients = barrier['ingredients']
        for ingredient_name in ingredients.keys():
            ingredient = ingredients[ingredient_name]
            ingredient.update({'name': ingredient_name})
            components.append(ingredient)

for comp in components:
    if 'done' not in comp.keys():
        raise Exception(comp)

components = [comp for comp in components if comp.get('duplicate', False) is False]
components = [comp for comp in components if comp['done'] is True]

components_by_method = defaultdict(list)
for comp in components:
    methods_string = comp['evaluation_methods'] or "not explored"
    methods = methods_string.split(',')
    methods = [method.strip() for method in methods]
    for method in methods:
        components_by_method[method].append(comp)

method_names = {
    '5 second test': '5 Second Test',
    'think aloud': 'Think Aloud',
    'interview': 'Interview',
    'plus minus': '+/- test',
    'writing evaluation': 'Writing Evaluation',
    'not explored': 'Not Explored',
}

for key in components_by_method.keys():
    assert key in method_names, f"{key} not valid method"

table = texttable.Texttable()
table.header(COLS)
table.set_cols_width(WIDTHS)
table.set_header_align(ALIGNMENTS)
for method in method_names.keys():
    components = components_by_method[method]
    component_string = ",\n\n".join([comp['name'] for comp in components])
    #table.add_row([method, component_string])
    table.add_row([method_names[method], component_string])
print(table.draw())
```

: Methods used to explore intervention components. {#tbl-methods-for-components}

:::
<!-- end landcape -->