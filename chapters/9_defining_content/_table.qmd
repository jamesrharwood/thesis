::: {.landscape}

```{python}
#| column: page
#| echo: false
#| output: asis
import os
import yaml
from IPython.display import Markdown, display
from tabulate import tabulate
from data import BARRIERS
import texttable

SEE_ABOVE = ""

COLS = ['Intervention Ingredient', "Behaviour Change Technique", 'Intervention Function', 'Before', 'Now', ]
COL_RANGE = range(len(COLS))
WIDTHS = [400, 200, 200, 400, 400]
ALIGNMENTS = ['l' for _ in COL_RANGE]
DIR = os.getcwd()
FP = os.path.join(DIR, 'chapters', '9_defining_content', 'planning_table.yaml')
with open(FP, 'r') as f:
    data = yaml.safe_load(f)
table = texttable.Texttable()
table.header(COLS)
table.set_cols_width(WIDTHS)
table.set_header_align(ALIGNMENTS)
for key_behaviour, barriers in data.items():
    table.add_row([f'[**Key Behaviour: {key_behaviour}**]{{.nowrap .text-info}}', '', '', '', ''])
    for barrier, details in barriers.items():
        target = BARRIERS[barrier].driver.title
        text = f'[**Targeted barrier: {BARRIERS[barrier].title}**]{{.nowrap}}'
        text += '\n\n'
        text += f'[**Behavioural driver: {target}**]{{.nowrap}}'
        table.add_row([text, '', '', '', ''])
        ingredients = details['ingredients']
        if type(ingredients)==dict:
            for desc, values in ingredients.items():
                try:
                    before = f'{values["before"] or SEE_ABOVE}'
                    examples = values["before_example"]
                    if examples: 
                        before += f'\n\nExample: {examples}'
                    now = f'{values["now"] or SEE_ABOVE}'
                    examples = values["now_example"]
                    if examples: 
                        now += f'\n\nExample: {examples}'
                    BCT = values['BCT'] or 'See above'
                    done = values['done']
                    assert type(done) is bool
                    if not done:
                        desc += "*"
                except Exception as e:
                    print(values)
                    raise Exception(desc)
                IF = values.get('IF', 'See above')
                table.add_row([desc, BCT, IF, before, now])
print(table.draw())
```

: Intervention Planning Table. Intervention components labelled with the behaviour change techniques and intervention functions they employ, and grouped according to the key behaviours, barriers, and behavioural drivers that they aim to target. Where possible, examples demonstrate how components were (or were not) used originally (Before) and, how they are included within the redesigned intervention (Now). {#tbl-int-plan}

::: 
<!-- end of landcape -->